<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status da Plataforma Angola ODS</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { display: flex; align-items: center; margin: 20px 0; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        .online { background: #22c55e; }
        .offline { background: #ef4444; }
        .loading { background: #f59e0b; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .info { background: #f8fafc; padding: 15px; border-radius: 5px; margin: 15px 0; }
        pre { background: #1f2937; color: #e5e7eb; padding: 15px; border-radius: 5px; overflow-x: auto; }
        button { background: #3b82f6; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        h1 { color: #1f2937; }
        h2 { color: #374151; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ‡¦ðŸ‡´ Plataforma de Sustentabilidade Angola</h1>
        <h2>Status do Sistema Keep-Alive</h2>
        
        <div class="status">
            <div class="status-dot loading" id="status-dot"></div>
            <span id="status-text">Verificando status...</span>
        </div>
        
        <div class="info">
            <strong>Keep-Alive Status:</strong><br>
            â€¢ Consultas automÃ¡ticas ao banco a cada 4 minutos<br>
            â€¢ Sistema ativo 24/7 para evitar hibernaÃ§Ã£o<br>
            â€¢ Endpoints monitorados: /api/projects, /api/sdgs
        </div>
        
        <button onclick="checkStatus()">ðŸ”„ Verificar Status</button>
        <button onclick="testKeepAlive()">ðŸ§ª Teste Keep-Alive</button>
        
        <h3>InformaÃ§Ãµes do Sistema:</h3>
        <pre id="system-info">Carregando...</pre>
        
        <h3>Logs de Teste:</h3>
        <pre id="logs">Aguardando testes...</pre>
    </div>

    <script>
        async function checkStatus() {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const systemInfo = document.getElementById('system-info');
            
            statusDot.className = 'status-dot loading';
            statusText.textContent = 'Verificando status...';
            
            try {
                const response = await fetch('/api/projects');
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    statusDot.className = 'status-dot online';
                    statusText.textContent = 'Sistema online e funcionando';
                    
                    systemInfo.textContent = JSON.stringify({
                        status: 'online',
                        timestamp: new Date().toISOString(),
                        projectsCount: data.length,
                        endpoint: '/api/projects',
                        keepAliveActive: true
                    }, null, 2);
                } else {
                    throw new Error('Resposta invÃ¡lida');
                }
            } catch (error) {
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'Sistema offline ou com problemas';
                systemInfo.textContent = 'Erro: ' + error.message;
            }
        }
        
        async function testKeepAlive() {
            const logs = document.getElementById('logs');
            logs.textContent = 'Executando teste keep-alive...\n';
            
            try {
                // Testar mÃºltiplos endpoints
                const endpoints = ['/api/projects', '/api/sdgs', '/'];
                
                for (const endpoint of endpoints) {
                    logs.textContent += `\nTestando ${endpoint}...`;
                    const start = Date.now();
                    const response = await fetch(endpoint);
                    const duration = Date.now() - start;
                    
                    if (response.ok) {
                        logs.textContent += ` âœ“ (${duration}ms)`;
                    } else {
                        logs.textContent += ` âœ— (${response.status})`;
                    }
                }
                
                logs.textContent += '\n\nTeste concluÃ­do! Sistema keep-alive funcionando.';
                
                // Atualizar status
                await checkStatus();
                
            } catch (error) {
                logs.textContent += '\nErro durante teste: ' + error.message;
            }
        }
        
        // Verificar status automaticamente ao carregar
        checkStatus();
        
        // Auto-refresh a cada 30 segundos
        setInterval(checkStatus, 30000);
    </script>
</body>
</html>